{% extends 'layout.html' %}
{% block title %}Edit Schedule Blocks - {{ schedule.name }}{% endblock %}
{% block content %}
<div class="container mt-4">
  <h2 class="mb-4">üóìÔ∏è Edit Blocks for <strong>{{ schedule.name }}</strong></h2>

  <!-- Existing Blocks -->
  <form method="POST">
    <input type="hidden" name="block_editor" value="1">

    {% if blocks %}
    <div class="table-responsive mb-4">
      <table class="table table-bordered align-middle">
        <thead class="table-light">
          <tr>
            <th>Remove</th>
            <th>Day</th>
            <th>Location</th>
            <th>Start</th>
            <th>End</th>
            <th>Week Type</th>
          </tr>
        </thead>
        <tbody>
          {% for block in blocks %}
          <tr>
            <td>
              <input type="checkbox" name="remove[]" value="{{ block.id }}">
            </td>
            <td>{{ block.day_of_week }}</td>
            <td>{{ block.location }}</td>
            <td>{{ block.start_time }}</td>
            <td>{{ block.end_time }}</td>
            <td>{{ block.week_type }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% endif %}

    <!-- Add New Blocks -->
    <div class="card card-body shadow-sm mb-3">
      <h5>Add New Blocks</h5>
      <div id="block-fields">
        <div class="row g-2 align-items-end block-row">
          <div class="col-md-2">
            <label class="form-label">Day</label>
            <select name="day[]" class="form-select" required>
              <option value="">Select</option>
              {% for d in ['Monday','Tuesday','Wednesday','Thursday','Friday','Saturday','Sunday'] %}
              <option value="{{ d }}">{{ d }}</option>
              {% endfor %}
            </select>
          </div>
          <div class="col-md-3">
            <label class="form-label">Location</label>
            <select name="location[]" class="form-select" required>
              {% for loc in locations %}
              <option value="{{ loc }}">{{ loc }}</option>
              {% endfor %}
            </select>
          </div>
          <div class="col-md-2">
            <label class="form-label">Start</label>
            <input type="time" name="start_time[]" class="form-control" required>
          </div>
          <div class="col-md-2">
            <label class="form-label">End</label>
            <input type="time" name="end_time[]" class="form-control" required>
          </div>
          <div class="col-md-2">
            <label class="form-label">Week Type</label>
            <select name="week_type[]" class="form-select">
              <option value="both">Both</option>
              <option value="A">A</option>
              <option value="B">B</option>
            </select>
          </div>
        </div>
      </div>
      <button type="button" class="btn btn-outline-secondary mt-3" onclick="addBlockRow()">‚ûï Add Another Block</button>
    </div>

    <div class="d-flex justify-content-between">
      <a href="{{ url_for('schedules.manage_schedules') }}" class="btn btn-outline-secondary">Cancel</a>
      <button type="submit" class="btn btn-primary">üíæ Save Changes</button>
    </div>
  </form>
</div>

<script>
function addBlockRow() {
  const row = document.querySelector('.block-row');
  const clone = row.cloneNode(true);
  clone.querySelectorAll('input, select').forEach(el => el.value = '');
  document.getElementById('block-fields').appendChild(clone);
}
</script>
{% endblock %}
{% extends "layout.html" %}

{% block title %}Add Resident - RezScan{% endblock %}

{% block content %}
<div class="container mt-4">
    <h2 class="mb-4">Add Resident</h2>

    <form method="POST" id="addResidentForm">
        <div class="mb-3">
            <label for="name" class="form-label">Full Name</label>
            <input type="text" 
                   name="name" 
                   id="name" 
                   pattern="^[A-Za-z, ]+$" 
                   class="form-control" 
                   placeholder="LAST NAME, FIRST NAME" 
                   oninput="filterInput(this);" 
                   required 
                   aria-label="Full Name">
        </div>    

        <div class="mb-3">
            <label for="mdoc" class="form-label">MDOC Number</label>
            <input type="text" 
                   name="mdoc" 
                   id="mdoc" 
                   class="form-control" 
                   placeholder="" 
                   value="{{ mdoc_prefill }}" 
                   oninput="filterNumberInput(this);" 
                   required
                   maxlength="10"
                   aria-label="MDOC Number">
            <div id="mdocError" class="invalid-feedback"></div>
        </div>

        <div class="mb-3">
            <label for="unit" class="form-label">Unit</label>
            <select name="unit" id="unit" class="form-select" required aria-label="Select Unit">
                <option value="" disabled selected>Select Unit</option>
                {% for unit in UNIT_OPTIONS %}
                    <option value="{{ unit }}">{{ unit }}</option>
                {% endfor %}
            </select>
        </div>

        <div class="mb-3">
            <label for="housing_unit" class="form-label">Housing Unit</label>
            <select name="housing_unit" id="housing_unit" class="form-select" required aria-label="Select Housing Unit">
                <option value="" disabled selected>Select Housing</option>
                {% for housing in HOUSING_OPTIONS %}
                    <option value="{{ housing }}">{{ housing }}</option>
                {% endfor %}
            </select>
        </div>

        <div class="mb-3">
            <label for="level" class="form-label">Level</label>
            <select name="level" id="level" class="form-select" required aria-label="Select Level">
                <option value="" disabled selected>Select Level</option>
                {% for level in LEVEL_OPTIONS %}
                    <option value="{{ level }}">{{ level }}</option>
                {% endfor %}
            </select>
        </div>

        <div class="d-flex gap-2">
            <button type="submit" class="btn btn-success" aria-label="Save Resident">Save Resident</button>
            <a href="javascript:history.back()" class="btn btn-secondary" aria-label="Cancel">Cancel</a>
        </div>
    </form>
</div>

<script>
document.addEventListener('DOMContentLoaded', function () {
    const mdocInput = document.getElementById('mdoc');
    const mdocError = document.getElementById('mdocError');
    const form = document.getElementById('addResidentForm');

    function validateMDOC() {
    const mdoc = mdocInput.value;
    const mdocRegex = /^[0-9]+$/; // Numeric only
    if (!mdocRegex.test(mdoc)) {
        mdocInput.classList.add('is-invalid');
        mdocError.textContent = 'MDOC must be numeric.';
        return false;
    }
    mdocInput.classList.remove('is-invalid');
    mdocInput.classList.add('is-valid');
    return true;
}

    mdocInput.addEventListener('input', validateMDOC);

    form.addEventListener('submit', function (event) {
        if (!validateMDOC()) {
            event.preventDefault();
        }
    });
});
// Only allows uppercase letters and spaces in the name field
function filterInput(el) {
    let p = el.selectionStart;
    el.value = el.value.toUpperCase().replace(/[^A-Z, ]/g, '');
    el.setSelectionRange(p, p);
}
// Only allows numbers in the MDOC field
function filterNumberInput(el) {
    let p = el.selectionStart;
    el.value = el.value.replace(/[^0-9]/g, '');
    el.setSelectionRange(p, p);
}
</script>
{% endblock %}
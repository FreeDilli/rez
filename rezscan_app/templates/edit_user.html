{% extends "layout.html" %}
{% block title %}Edit User - RezScan{% endblock %}

{% block content %}
<div class="container mt-4">
  <h2 class="mb-4">Update role for: {{ user.username }}</h2>
  <form method="POST" action="{{ url_for('users.edit_user', username=user.username) }}" id="editUserForm">
    <div class="form-group mb-3">
      <label for="role" class="form-label">Role</label>
      <select name="role" id="role" class="form-select" required aria-label="Select user role">
        {% for role in valid_roles %}
        <option value="{{ role }}" {% if user.role == role %}selected{% endif %}>{{ role.capitalize() }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="text-end">
      <button type="submit" class="btn btn-primary" aria-label="Save Changes">Save Changes</button>
      <a href="{{ url_for('users.manage_users') }}" class="btn btn-outline-secondary" aria-label="Cancel">Cancel</a>
    </div>
  </form>
</div>

<script>
document.addEventListener('DOMContentLoaded', function () {
  const form = document.getElementById('editUserForm');
  form.addEventListener('submit', function () {
    const toastEl = document.createElement('div');
    toastEl.className = 'toast align-items-center text-bg-success border-0';
    toastEl.setAttribute('role', 'alert');
    toastEl.setAttribute('aria-live', 'assertive');
    toastEl.setAttribute('aria-atomic', 'true');
    toastEl.setAttribute('data-bs-delay', '5000');
    toastEl.innerHTML = `
      <div class="d-flex">
        <div class="toast-body">
          âœ… User role updated successfully.
        </div>
        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
      </div>
    `;
    document.getElementById('toast-container').appendChild(toastEl);
    const toast = new bootstrap.Toast(toastEl);
    toast.show();
  });
});
</script>
{% endblock %}
{% extends "layout.html" %}
{% block title %}Admin Settings{% endblock %}

{% block content %}
<div class="container mt-4">
  <h2 class="mb-4">‚öôÔ∏è Admin Settings</h2>

  <!-- Toast Container -->
  <div class="position-fixed top-0 end-0 p-3" style="z-index: 1100">
    <div id="toast-container"></div>
  </div>

  <form method="post">
    {% for category, entries in settings.items() %}
      <div class="card mb-4">
        <div class="card-header fw-bold text-uppercase bg-light">{{ category }}</div>
        <div class="card-body">
          {% for key, value in entries %}
            <div class="mb-3">
              <label class="form-label">{{ key }}</label>
              <input type="text" class="form-control" name="{{ category }}|{{ key }}" value="{{ value }}">
            </div>
          {% endfor %}
        </div>
      </div>
    {% endfor %}
    <div class="text-end">
      <button type="submit" class="btn btn-primary">üíæ Save Changes</button>
    </div>
  </form>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function() {
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          const toast = document.createElement('div');
          toast.className = `toast align-items-center text-bg-{{ 'success' if category == 'success' else 'danger' }} border-0 show mb-2`;
          toast.setAttribute('role', 'alert');
          toast.setAttribute('aria-live', 'assertive');
          toast.setAttribute('aria-atomic', 'true');

          toast.innerHTML = `
            <div class="d-flex">
              <div class="toast-body">{{ message }}</div>
              <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>`;

          document.getElementById('toast-container').appendChild(toast);
        {% endfor %}
      {% endif %}
    {% endwith %}
  });
</script>
{% endblock %}

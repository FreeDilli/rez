{% extends "layout.html" %}
{% block title %}Admin Settings{% endblock %}

{% block content %}
<div class="container mt-4">
  <h2 class="mb-4">‚öôÔ∏è Admin Settings</h2>

  <form method="post">
    {% for category, entries in settings.items() %}
      <div class="card mb-4">
        <div class="card-header fw-bold text-uppercase bg-light">{{ category }}</div>
        <div class="card-body">
          {% for key, value in entries %}
            <div class="mb-3">
              <label class="form-label">{{ key }}</label>
              <input type="text" class="form-control" name="{{ category }}|{{ key }}" value="{{ value }}">
            </div>
          {% endfor %}
        </div>
      </div>
    {% endfor %}
    <div class="text-end">
      <button type="submit" class="btn btn-primary">üíæ Save Changes</button>
    </div>
  </form>
</div>

<script>
  // Pass flashed messages as a JSON array from Jinja2 to JavaScript
  const messages = {{ get_flashed_messages(with_categories=true) | tojson }};

  document.addEventListener("DOMContentLoaded", function() {
    // Check if there are any messages
    if (messages && messages.length > 0) {
      // Iterate over messages
      messages.forEach(({0: category, 1: message}) => {
        const toastElement = document.createElement('div');
        toastElement.className = `toast align-items-center text-bg-${category === 'success' ? 'success' : 'danger'} border-0`;
        toastElement.setAttribute('role', 'alert');
        toastElement.setAttribute('aria-live', 'assertive');
        toastElement.setAttribute('aria-atomic', 'true');

        toastElement.innerHTML = `
          <div class="d-flex">
            <div class="toast-body">${message}</div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
          </div>`;

        document.getElementById('toast-container').appendChild(toastElement);

        // Initialize Bootstrap toast
        const bsToast = new bootstrap.Toast(toastElement, { delay: 5000 });
        bsToast.show();
      });
    }
  });
</script>
{% endblock %}

{% extends "layout.html" %}
{% block title %}Scheduling - RezScan{% endblock %}

{% block content %}
<h2 class="mb-4">Scheduling</h2>

<!-- 🔍 Filter Bar -->
<form method="GET" class="row g-3 align-items-end mb-4">
  <div class="col-md-4">
    <label for="search" class="form-label">Search Resident</label>
    <input type="text" name="search" id="search" class="form-control" placeholder="Name or MDOC" value="{{ request.args.get('search', '') }}">
  </div>
  <div class="col-md-3">
    <label for="date" class="form-label">Date</label>
    <input type="date" name="date" id="date" class="form-control" value="{{ request.args.get('date', '') or current_date }}">
  </div>
  <div class="col-md-auto">
    <button type="submit" class="btn btn-primary">Filter</button>
    <a href="{{ url_for('schedule.schedule') }}" class="btn btn-secondary">Reset</a>
  </div>
</form>

<!-- ➕ Scheduling Form -->
<form method="POST" action="{{ url_for('schedule.assign') }}" class="mb-5">
  <div class="row g-3">
    <div class="col-md-3">
      <label class="form-label">Resident MDOC</label>
      <input type="text" name="mdoc" class="form-control" required>
    </div>
    <div class="col-md-3">
      <label class="form-label">Date</label>
      <input type="date" name="date" class="form-control" value="{{ selected_date or current_date }}" required>
    </div>
    <div class="col-md-3">
      <label class="form-label">Time Block</label>
      <select name="block" class="form-select" required>
        <option value="Morning">Morning</option>
        <option value="Afternoon">Afternoon</option>
        <option value="Evening">Evening</option>
      </select>
    </div>
    <div class="col-md-3">
      <label class="form-label">Program</label>
      <select name="program" class="form-select" required>
        <option value="Education">Education</option>
        <option value="Work">Work</option>
        <option value="Gym">Gym</option>
        <option value="Other">Other</option>
      </select>
    </div>
    <div class="col-12 text-end">
      <button type="submit" class="btn btn-success">Assign</button>
    </div>
  </div>
</form>

<!-- 📋 Scheduled Residents Table -->
<h4>Scheduled Residents</h4>
<div class="table-responsive">
  <table class="table table-striped table-hover">
    <thead class="table-light">
      <tr>
        <th>Name</th>
        <th>MDOC</th>
        <th>Time Block</th>
        <th>Program</th>
        <th>Date</th>
        {% if current_user.role in ['admin', 'scheduling'] %}
        <th class="text-center">Actions</th>
        {% endif %}
      </tr>
    </thead>
    <tbody>
      {% for entry in schedule %}
      <tr>
        <td>{{ entry.name }}</td>
        <td>{{ entry.mdoc }}</td>

        <!-- 🎨 Styled Time Block -->
        <td>
          <span class="badge 
            {% if entry.block == 'Morning' %}bg-success
            {% elif entry.block == 'Afternoon' %}bg-warning
            {% elif entry.block == 'Evening' %}bg-primary
            {% endif %}">
            {{ entry.block }}
          </span>
        </td>

        <!-- 🎨 Styled Program -->
        <td>
          <span class="badge 
            {% if entry.program == 'Education' %}text-bg-info
            {% elif entry.program == 'Work' %}text-bg-secondary
            {% elif entry.program == 'Gym' %}text-bg-success
            {% else %}text-bg-dark
            {% endif %}">
            {{ entry.program }}
          </span>
        </td>

        <td>{{ entry.date }}</td>

        {% if current_user.role in ['admin', 'scheduling'] %}
        <td class="text-center">
          <a href="{{ url_for('schedule.delete', id=entry.id) }}" class="btn btn-sm btn-outline-danger" onclick="return confirm('Remove this schedule entry?');">Remove</a>
        </td>
        {% endif %}
      </tr>
      {% else %}
      <tr>
        <td colspan="6" class="text-center text-muted">No scheduled entries for this day.</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}